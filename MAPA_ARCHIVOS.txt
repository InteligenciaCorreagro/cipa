MAPA RÃPIDO DE ARCHIVOS DEL PROYECTO CIPA
==========================================

ESTRUCTURA DEL PROYECTO:
/home/user/cipa/
â”‚
â”œâ”€â”€ .github/workflows/          â† AUTOMATIZACIÃ“N
â”‚   â”œâ”€â”€ daily_process.yml       (283 lÃ­neas) - Ejecuta main.py diariamente 8:00 AM
â”‚   â””â”€â”€ backup_semanal.yml      (79 lÃ­neas) - Backup BD los domingos
â”‚
â”œâ”€â”€ backend/                    â† BACKEND PYTHON
â”‚   â”‚
â”‚   â”œâ”€â”€ main.py                 (301 lÃ­neas) - ORQUESTADOR PRINCIPAL
â”‚   â”‚   â””â”€ Llamado por GitHub Actions
â”‚   â”‚   â””â”€ Coordina: API â†’ ValidaciÃ³n â†’ Notas â†’ Excel â†’ Email
â”‚   â”‚
â”‚   â”œâ”€â”€ export_operativa_custom.py  (345 lÃ­neas) - ExportaciÃ³n con rango fechas
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   â† MÃ“DULOS DE NEGOCIO (CRÃTICOS)
â”‚   â”‚   â”œâ”€â”€ api_client.py       (139 lÃ­neas) - Cliente API SIESA
â”‚   â”‚   â”œâ”€â”€ business_rules.py   (318 lÃ­neas) - Validaciones (tipos, montos)
â”‚   â”‚   â”œâ”€â”€ notas_credito_manager.py (670 lÃ­neas) - â­ GESTIÃ“N NOTAS (CRÃTICO)
â”‚   â”‚   â”œâ”€â”€ excel_processor.py  (400+) - GeneraciÃ³n Excel
â”‚   â”‚   â”œâ”€â”€ email_sender.py     (106) - EnvÃ­o SMTP
â”‚   â”‚   â””â”€â”€ archivador_notas.py (400+) - Archivado completadas
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                    â† API REST FLASK
â”‚   â”‚   â”œâ”€â”€ app.py              (1300+ lÃ­neas) - Servidor Flask + endpoints
â”‚   â”‚   â”œâ”€â”€ auth.py             (426 lÃ­neas) - JWT + bcrypt
â”‚   â”‚   â””â”€â”€ README.md           - DocumentaciÃ³n endpoints
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/                â† UTILIDADES
â”‚   â”‚   â”œâ”€â”€ backup_database.py
â”‚   â”‚   â”œâ”€â”€ consultar_notas.py
â”‚   â”‚   â”œâ”€â”€ reporte_diario.py
â”‚   â”‚   â”œâ”€â”€ verificar_config.py
â”‚   â”‚   â”œâ”€â”€ test_api_connection.py
â”‚   â”‚   â”œâ”€â”€ inicializar_auth.py
â”‚   â”‚   â”œâ”€â”€ limpiar_notas_invalidas.py
â”‚   â”‚   â”œâ”€â”€ procesar_y_guardar_facturas.py
â”‚   â”‚   â””â”€â”€ migrations/         - Scripts de migraciÃ³n BD
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                   â† BASE DE DATOS
â”‚   â”‚   â””â”€â”€ notas_credito.db    (749 KB) - SQLite versionada en Git
â”‚   â”‚
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.py           (vacÃ­o actualmente)
â”‚   â”‚
â”‚   â”œâ”€â”€ requirements.txt        - Dependencias Python
â”‚   â”œâ”€â”€ .env.example            - Variables de entorno plantilla
â”‚   â”œâ”€â”€ .env.production         - ConfiguraciÃ³n producciÃ³n
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ frontend/                   â† FRONTEND REACT
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ NotasPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ NotaDetailPage.tsx
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â””â”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useNotas.ts
â”‚   â”‚   â”‚   â””â”€â”€ useFacturas.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ docs/                       â† DOCUMENTACIÃ“N
â”‚   â”œâ”€â”€ ARQUITECTURA.md         - Diagramas Mermaid
â”‚   â”œâ”€â”€ GUIA_RAPIDA.md
â”‚   â”œâ”€â”€ API_ENDPOINTS.md
â”‚   â”œâ”€â”€ INSTRUCCIONES_POBLAR_BD.md
â”‚   â””â”€â”€ *.md (8 archivos total)
â”‚
â”œâ”€â”€ postman/                    â† TESTING
â”‚   â”œâ”€â”€ CIPA_API_Collection.postman_collection.json
â”‚   â””â”€â”€ CIPA_API_Environment.postman_environment.json
â”‚
â”œâ”€â”€ data/                       â† REPORTES GENERADOS
â”‚   â””â”€â”€ (aquÃ­ se generan Excel y TXT diarios)
â”‚
â”œâ”€â”€ output/                     â† OUTPUTS TEMPORALES
â”‚   â””â”€â”€ (reportes generados)
â”‚
â”œâ”€â”€ ARQUITECTURA_COMPLETA.md    â† DOCUMENTACIÃ“N DETALLADA (NUEVO)
â”œâ”€â”€ RESUMEN_EJECUTIVO.txt       â† ESTE RESUMEN (NUEVO)
â”œâ”€â”€ README.md                   - PÃ¡gina inicio proyecto
â”œâ”€â”€ DEPLOYMENT_RENDER.md        - GuÃ­a deployment
â”œâ”€â”€ GODADDY_CONFIGURATION.md    - Config dominio
â””â”€â”€ .gitignore                  - Archivos ignorados


ARCHIVOS CLAVE POR FUNCIÃ“N:
===========================

ğŸ”´ ORQUESTACIÃ“N PRINCIPAL:
â”œâ”€ .github/workflows/daily_process.yml
â””â”€ backend/main.py

ğŸŸ  VALIDACIÃ“N REGLAS NEGOCIO:
â”œâ”€ backend/core/business_rules.py (23 tipos excluidos, monto mÃ­nimo)
â””â”€ backend/core/notas_credito_manager.py (aplicaciÃ³n notas)

ğŸŸ¡ PROCESAMIENTO API:
â”œâ”€ backend/core/api_client.py
â””â”€ Consulta: Api_Consulta_Fac_Correagro

ğŸŸ¢ GENERACIÃ“N REPORTES:
â”œâ”€ backend/core/excel_processor.py
â”œâ”€ backend/core/email_sender.py
â””â”€ backend/export_operativa_custom.py

ğŸ”µ PERSISTENCIA:
â”œâ”€ backend/api/auth.py (gestiÃ³n usuarios)
â”œâ”€ backend/core/notas_credito_manager.py (CRUD notas)
â””â”€ data/notas_credito.db (SQLite principal)

ğŸŸ£ API REST:
â”œâ”€ backend/api/app.py (endpoints)
â”œâ”€ backend/api/auth.py (JWT)
â””â”€ backend/api/requirements.txt

âšª FRONTEND:
â””â”€ frontend/ (React + TS)


BASE DE DATOS - TABLAS:
======================

OPERATIVAS:
â”œâ”€ notas_credito (0 registros) - Notas en espera de aplicaciÃ³n
â”œâ”€ aplicaciones_notas (0) - Historial de aplicaciones
â”œâ”€ facturas_rechazadas (2,955) - AuditorÃ­a
â””â”€ tipos_inventario_detectados (0) - CatÃ¡logo descubierto

AUTENTICACIÃ“N:
â”œâ”€ usuarios (1: admin)
â”œâ”€ sesiones - Tracking JWT
â””â”€ intentos_login - AuditorÃ­a acceso

ÃNDICES CREADOS:
â”œâ”€ idx_notas_cliente_producto
â”œâ”€ idx_aplicaciones_nota
â”œâ”€ idx_rechazadas_fecha
â”œâ”€ idx_rechazadas_tipo
â””â”€ idx_tipos_codigo


FLUJO DIARIO COMPLETO:
======================

8:00 AM BogotÃ¡ (13:00 UTC)
  â†“
GitHub Actions â†’ daily_process.yml
  â†“
1. Checkout + Setup Python
  â†“
2. Crear backup BD
  â†“
3. Ejecutar: python backend/main.py
  â”‚
  â”œâ”€ api_client.py: obtener facturas SIESA
  â”œâ”€ business_rules.py: filtrar por tipo + monto
  â”œâ”€ notas_credito_manager.py: registrar + aplicar
  â”œâ”€ excel_processor.py: generar Excel
  â””â”€ email_sender.py: enviar correo
  â†“
4. Commit BD actualizada
  â†“
5. Upload artifacts
  â”‚
  â”œâ”€ facturas_YYYYMMDD.xlsx (30 dÃ­as)
  â”œâ”€ *.txt reportes (30 dÃ­as)
  â””â”€ backup BD (7 dÃ­as)
  â†“
6. Email operativa recibe:
   â””â”€ Archivo Excel adjunto + resumen


SECRETOS GITHUB REQUERIDOS:
===========================

Para que funcione daily_process.yml necesita:

API SIESA:
â”œâ”€ CONNI_KEY
â””â”€ CONNI_TOKEN

SMTP EMAIL:
â”œâ”€ EMAIL_USERNAME
â”œâ”€ EMAIL_PASSWORD
â”œâ”€ SMTP_SERVER
â”œâ”€ SMTP_PORT
â””â”€ DESTINATARIOS (correos separados por coma)

Configurar en: GitHub repo â†’ Settings â†’ Secrets and variables â†’ Actions


SCRIPTS ÃšTILES DISPONIBLES:
============================

backend/scripts/

Backup:
â””â”€ python backup_database.py crear --db-path data/notas_credito.db --backup-dir backups

Consulta:
â””â”€ python consultar_notas.py --estado PENDIENTE --cliente NIT

Reportes:
â””â”€ python reporte_diario.py

VerificaciÃ³n:
â”œâ”€ python verificar_config.py
â”œâ”€ python verificar_usuario_admin.py
â””â”€ python test_api_connection.py

Inicializar:
â””â”€ python inicializar_auth.py


ESTADÃSTICAS CÃ“DIGO:
====================

Backend Python: ~3,000 lÃ­neas
â”œâ”€ main.py: 301
â”œâ”€ core/notas_credito_manager.py: 670
â”œâ”€ core/business_rules.py: 318
â”œâ”€ core/excel_processor.py: 400+
â”œâ”€ api/app.py: 1300+
â””â”€ Otros scripts

Frontend React: 
â”œâ”€ TypeScript + Vite
â””â”€ Tailwind CSS

Total Proyecto: ~5,000+ lÃ­neas cÃ³digo


REFERENCIAS RÃPIDAS:
====================

API Health:
  GET /api/health

Login:
  POST /api/login
  body: {username, password}

Notas CrÃ©dito:
  GET /api/notas-credito
  GET /api/notas-credito/{id}/historial
  GET /api/resumen

Facturas:
  GET /api/facturas-rechazadas
  GET /api/tipos-inventario

Frontend:
  http://localhost:3000

Backend:
  http://localhost:5000

Admin inicial:
  username: admin
  password: admin123


PUNTOS CRÃTICOS DE FALLO:
==========================

1. API SIESA no disponible
   â†’ main.py registra error y sale
   â†’ Reintento manual necesario

2. Secretos GitHub incorrectos
   â†’ Workflow falla
   â†’ Revisar Settings â†’ Secrets

3. BD corrupta
   â†’ Restaurar desde backup semanal
   â†’ Artifacts â†’ backup-bd-XXX

4. SMTP no funciona
   â†’ Email no se envÃ­a
   â†’ Log disponible en GitHub Actions

5. Tipo inventario no configurado
   â†’ Detecta automÃ¡ticamente â†’ tabla tipos_inventario_detectados
   â†’ Puede necesitar agregarse a lista excluidos


PRÃ“XIMOS PASOS RECOMENDADOS:
=============================

1. Cambiar contraseÃ±a admin (urgente)
   â””â”€ Script: python backend/scripts/cambiar_contraseÃ±a.py

2. Configurar secretos GitHub (obligatorio)
   â””â”€ CONNI_KEY, CONNI_TOKEN, EMAIL_*, SMTP_*

3. Probar API SIESA
   â””â”€ Script: python backend/scripts/test_api_connection.py

4. Generar primer reporte manual
   â””â”€ Script: python backend/main.py

5. Verificar envÃ­o email
   â””â”€ Revisar SMTP_SERVER, SMTP_PORT, EMAIL_PASSWORD

6. Iniciar API REST (desarrollo)
   â””â”€ python backend/iniciar_api.py

7. Iniciar Frontend
   â””â”€ cd frontend && npm run dev
